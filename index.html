<!DOCTYPE html>
<html lang="en">
<head>
	    <!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<title>Dapp</title>
		<script src="libs/nebPay.js"></script>
		<script src="libs/jquery-3.1.1.min.js"></script>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
</head>

<body>
	<div class="container">
		<nav class="navbar navbar-expand-lg navbar-light bg-light">
				<a class="navbar-brand" href="#">Questions - Daaps NEB</a>
				<div class="collapse navbar-collapse" id="navbarNav">
					<ul class="navbar-nav">
	<!-- 						<li class="nav-item">
						<a class="nav-link disabled" href="#">My Questions</a>
					</li> -->
					</ul>
				</div>
				<button class="btn btn-sm btn-primary" type="button">New Question</button> &nbsp;
				<button class="btn btn-sm btn-secondary" type="button">My Questions</button>
			</nav>
			<br>
			<br>
			<br>
				
			<div class="row">
				<div class="col-4">
					<div class="question-box">
						<h4>¿Quien ganará el mundial?</h4>
						<form id="voteSubmit">
								<input type="radio" name="vote" value="Brazil"> Brazil<br>
								<input type="radio" name="vote" value="Argentina"> Argentina <br>
								<input type="radio" name="vote" value="France"> France <br>
								<input type="radio" name="vote" value="Germany"> Germany<br>
								<input type="radio" name="vote" value="Portugal"> Portugal <br>
								<button type="submit" class="btn btn-primary">Vote</button>
						</form>
					</div>
				</div>
			</div>
				
			<p>You voted for: </p>
			<button type="button" id="btnGetVote"> Refresh</button>
			<p id="myVote"></p>
	</div>


<script>

	var contract_address = "n1zsH1HnWbQPw7rLRxc9CRw5gjT6qfzyt7P"
	var txhash = null;
	var NebPay = require("nebpay");
	var nebPay = new NebPay();

	$( document ).ready(function() {
		if(typeof(webExtensionWallet) === "undefined"){
		alert ("Extension wallet is not installed, please install it first.")
		}
		$('#btnGetVote').click(GetVote);
		GetQuestion();
	});

	function GetQuestion(){
		nebPay.simulateCall(contract_address,0,"getQuestion",null,{
			qrcode: {
				showQRCode: false,
				completeTip: undefined, 
				cancelTip: undefined,
				container: undefined
		 	},
			callback: "https://pay.nebulas.io/api/pay",
			listener: ShowQuestion	
		});
	}

	function ShowQuestion(resp){
		var question = JSON.parse(resp.result);
		alert(question);
	}

	$('#voteSubmit').submit(function(vote){
		var vote = $(':radio[name=vote]:checked').val();
		nebPay.call(contract_address,0,"submitVote",JSON.stringify([vote]),{
			qrcode: {
				showQRCode: false,
				completeTip: undefined, 
				cancelTip: undefined,
				container: undefined
		 	},
			callback: NebPay.config.testnetUrl,
			listener: VoteSubmitted
		});		
		event.preventDefault();
	});

	function VoteSubmitted(resp){
		txhash = resp.txhash;
		console.log("txhash => " + txhash);
	}
	function GetVote(){
		nebPay.simulateCall(contract_address,0,"getVote",JSON.stringify([txhash]),{
			callback: NebPay.config.testnetUrl,
			listener: function(resp){
				var response = JSON.parse(resp.result);
				if(response){
					$('#myVote').text(reseponse.vote);
				}
				else{
					$('#myVote').text("null");
				}
			}
		});
		event.preventDefault();
	}

</script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
</body>
</html>